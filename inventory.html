<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Salt's Black Market</title>
<style>
:root{
  --bg:#0b0d10;
  --panel:#13161d;
  --panel-2:#0f1117;
  --text:#e8ecf1;
  --muted:#9aa4b2;
  --accent:#00fa9a;
  --shadow:0 10px 30px rgba(0,0,0,.35);
  --radius:18px;
  --glow:0 0 15px var(--accent);
}
body{margin:0;font-family:sans-serif;background:var(--bg);color:var(--text);}
.container{max-width:1100px;margin:24px auto;padding:0 16px}
header{display:flex;align-items:center;gap:16px;justify-content:space-between;flex-wrap:wrap;margin-bottom:18px;}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:40px;height:40px;border-radius:12px;background:var(--accent);box-shadow:0 0 10px var(--accent);}
h1{margin:0}
.muted{color:var(--muted)}
.controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.control{background:var(--panel);border:1px solid var(--accent);color:var(--text);border-radius:12px;padding:6px 10px;box-shadow:var(--shadow);display:flex;align-items:center;gap:6px;}
.control input,.control select{background:transparent;color:var(--text);border:none;outline:none;font-size:14px;}
.control select{appearance:none;padding-right:18px;cursor:pointer;background-color:var(--panel);}
.control option{background-color:var(--panel);color:var(--text);}
.control input::placeholder{color:var(--muted)}
.btn{cursor:pointer;transition:box-shadow .2s ease}
.btn:hover{box-shadow:var(--glow)}
.grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));}
.card{background:var(--panel);border:1px solid #202435;border-radius:var(--radius);overflow:hidden;position:relative;box-shadow:var(--shadow);cursor:pointer;}
.thumb{position:relative;aspect-ratio:1/1;background:var(--panel-2)}
.thumb img{width:100%;height:100%;object-fit:cover;display:block}
.label{padding:12px 14px;display:flex;flex-direction:column;gap:6px}
.title{font-size:14px;font-weight:bold}

/* Lightbox zoom styles */
.lightbox {
  position: fixed;
  inset: 0;
  display: none;
  z-index: 50;
}
.lightbox.active {
  display: block;
}
.backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  z-index: 0;
}
.viewer {
  position: fixed;
  border-radius:20px;
  box-shadow:var(--shadow);
  z-index: 10;
  transition: all 0.3s ease;
  transform-origin: center center;
  background: var(--panel-2);
  overflow: hidden;
  cursor: pointer;
}
.viewer:hover {
  box-shadow: var(--glow);
}
.viewer img {
  width: 100%;
  height: 100%;
  object-fit: contain; /* ensures entire image fits */
  display: block;
}
.close {
  position: fixed;
  top: 10px;
  right: 10px;
  background: var(--panel);
  color: var(--accent);
  border: 1px solid var(--accent);
  border-radius: 999px;
  padding: 6px 10px;
  cursor: pointer;
  z-index: 20;
}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>Salt's Inventory</h1>
        <div class="muted" style="font-size:12px">Not selling these just showing off</div>
      </div>
    </div>
    <div class="controls">
      <label class="control">ðŸ”Ž <input id="search" type="search" placeholder="Search items" /></label>
      <label class="control">Sort: <select id="sort"><option value="new">Newest</option><option value="name">Name Aâ†’Z</option></select></label>
      <button class="control btn" id="refresh">Refresh</button>
    </div>
  </header>
  <div id="grid" class="grid"></div>
  <div id="empty" class="muted" style="display:none">No items found</div>
</div>

<div id="lightbox" class="lightbox">
  <div class="backdrop" data-close></div>
  <div class="viewer">
    <img id="viewImg" alt="" />
  </div>
  <button class="close" data-close>âœ•</button>
</div>

<script>
const DEBUG_MODE = false;
const PASTEBIN_RAW_URL = "https://pastebin.com/raw/YsjGXKzN";
const PROXY_URL = "https://api.allorigins.win/raw?url=";

async function loadItems(){
  const resp = await fetch(PROXY_URL + encodeURIComponent(PASTEBIN_RAW_URL) + "&_=" + Date.now());
  if(!resp.ok){ console.error("Failed to fetch pastebin", resp.status); return []; }
  const text = await resp.text();
  localStorage.setItem('cachedPastebin', text);
  return parseItems(text);
}

function parseItems(text){
  return text.trim().split(/\n+/).map(line => {
    const parts = line.split('|');
    if(parts.length < 2) return null;
    const name = parts[0].trim();
    const imgur = parts[1].trim();
    return {name, imgur};
  }).filter(Boolean);
}

function imgUrl(link){
  const m = link.match(/(?:https?:\/\/)?(?:i\.)?imgur\.com\/([a-zA-Z0-9]{5,10})(?:\.(jpg|jpeg|png|gif|webp))?/);
  if(!m) return '';
  return `https://i.imgur.com/${m[1]}.${m[2] || 'jpg'}`;
}

const collator = new Intl.Collator(undefined,{numeric:true,sensitivity:'base'});
let records=[];

function render(){
  const q=document.getElementById('search').value.trim().toLowerCase();
  const sort=document.getElementById('sort').value;
  let list=[...records];
  if(q){list=list.filter(r=>r.name.toLowerCase().includes(q));}
  list.sort((a,b)=>{
    if(sort==='name')return collator.compare(a.name,b.name);
    return b.createdAt-a.createdAt;
  });
  const grid=document.getElementById('grid');
  grid.innerHTML='';
  list.forEach(rec=>{
    const card=document.createElement('article');
    card.className='card';
    card.innerHTML=`<div class="thumb btn" data-key="${rec.key}"><img src="${imgUrl(rec.imgur)}" alt="${rec.name}"/></div><div class="label"><div class="title">${rec.name}</div></div>`;
    grid.appendChild(card);
  });
  document.getElementById('empty').style.display=list.length?'none':'block';
}

document.addEventListener('click', e=>{
  if(e.target.matches('[data-close]')) return closeLightbox();
  const t=e.target.closest('[data-key]');
  if(t){
    const rec=records.find(r=>r.key===t.dataset.key);
    if(!rec) return;

    const img = t.querySelector('img');
    const rect = img.getBoundingClientRect();

    const viewer = document.querySelector('.viewer');
    const viewImg = document.getElementById('viewImg');
    viewImg.src = imgUrl(rec.imgur);

    // set initial position
    viewer.style.width = rect.width + 'px';
    viewer.style.height = rect.height + 'px';
    viewer.style.top = rect.top + 'px';
    viewer.style.left = rect.left + 'px';
    viewer.style.transform = 'translate(0,0)';

    const lightbox = document.getElementById('lightbox');
    lightbox.classList.add('active');

    // animate to center and fit screen
    requestAnimationFrame(()=> {
      const maxWidth = window.innerWidth * 0.8;
      const maxHeight = window.innerHeight * 0.8;
      viewer.style.width = maxWidth + 'px';
      viewer.style.height = maxHeight + 'px';
      viewer.style.top = '50%';
      viewer.style.left = '50%';
      viewer.style.transform = 'translate(-50%, -50%)';
    });
  }
});

function closeLightbox(){
  const viewer = document.querySelector('.viewer');
  const lightbox = document.getElementById('lightbox');

  // animate back to card
  const imgKey = records.find(r=>imgUrl(r.imgur)===document.getElementById('viewImg').src);
  const card = Array.from(document.querySelectorAll('[data-key]')).find(c=>c.dataset.key===imgKey?.key);
  if(card){
    const img = card.querySelector('img');
    const rect = img.getBoundingClientRect();
    viewer.style.width = rect.width + 'px';
    viewer.style.height = rect.height + 'px';
    viewer.style.top = rect.top + 'px';
    viewer.style.left = rect.left + 'px';
    viewer.style.transform = 'translate(0,0)';
    setTimeout(()=> { lightbox.classList.remove('active'); document.getElementById('viewImg').src=''; }, 300);
  } else {
    lightbox.classList.remove('active'); 
    document.getElementById('viewImg').src='';
  }
}

document.getElementById('search').addEventListener('input',render);
document.getElementById('sort').addEventListener('change',render);
document.getElementById('refresh').addEventListener('click',init);

function init(){
  loadItems().then(items=>{
    records=items.map((it,i)=>({key:i+'-'+Math.random().toString(36).slice(2),...it,createdAt:Date.now()-i*1000}));
    render();
  });
}

const cached = localStorage.getItem('cachedPastebin');
if(cached){
  records=parseItems(cached).map((it,i)=>({key:i+'-'+Math.random().toString(36).slice(2),...it,createdAt:Date.now()-i*1000}));
  render();
}

init();
</script>
</body>
</html>
